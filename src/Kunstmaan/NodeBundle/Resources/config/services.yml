parameters:
    kunstmaan_node.version_timeout: 3600
    kunstmaan_node.slugrouter.class: Kunstmaan\NodeBundle\Router\SlugRouter
    kunstmaan_node.sluglistener.class: Kunstmaan\NodeBundle\EventListener\SlugListener
    kunstmaan_node.helper.url.class: Kunstmaan\NodeBundle\Helper\URLHelper
    kunstmaan_node.url_replace.twig.class: Kunstmaan\NodeBundle\Twig\UrlReplaceTwigExtension
    kunstmaan_node.url_chooser.lazy_increment: 2
    kunstmaan_multi_domain.url_replace.controller.class: Kunstmaan\NodeBundle\Controller\UrlReplaceController
    kunstmaan_node.toolbar.collector.node.class: Kunstmaan\NodeBundle\Toolbar\NodeDataCollector

services:
    Kunstmaan\NodeBundle\EventListener\NodeTranslationListener:
        arguments:
            - '@Symfony\Component\HttpFoundation\Session\Flash\FlashBagInterface'
            - '@kunstmaan_admin.logger'
            - '@Kunstmaan\UtilitiesBundle\Helper\SlugifierInterface'
            - '@Symfony\Component\HttpFoundation\RequestStack'
            - '@Kunstmaan\AdminBundle\Helper\DomainConfigurationInterface'
            - '@Kunstmaan\NodeBundle\Helper\PagesConfiguration'
        tags:
            - { name: 'doctrine.event_listener', event: 'onFlush', method: 'onFlush' }
            - { name: 'doctrine.event_listener', event: 'prePersist', method: 'prePersist' }
            - { name: 'doctrine.event_listener', event: 'preUpdate', method: 'preUpdate' }

    Kunstmaan\NodeBundle\Helper\Menu\PageMenuAdaptor:
        arguments:
            - '@Doctrine\ORM\EntityManagerInterface'
            - '@Kunstmaan\AdminBundle\Helper\Security\Acl\AclNativeHelper'
            - '@Kunstmaan\NodeBundle\Helper\PagesConfiguration'
            - '@Kunstmaan\AdminBundle\Helper\DomainConfigurationInterface'
        tags:
            -  { name: 'kunstmaan_admin.menu.adaptor' }

    Kunstmaan\NodeBundle\Form\Type\URLChooserType:
        tags:
            - { name: 'form.type' }

    Kunstmaan\NodeBundle\Form\Type\SlugType:
        arguments:
            - '@Kunstmaan\UtilitiesBundle\Helper\SlugifierInterface'
        tags:
            - { name: 'form.type' }

    Kunstmaan\NodeBundle\Form\NodeChoiceType:
        arguments:
            - "@request_stack"
        tags:
            - { name: form.type }

    Kunstmaan\NodeBundle\Helper\NodeAdmin\NodeAdminPublisher:
        arguments:
            - '@Doctrine\ORM\EntityManagerInterface'
            - '@Symfony\Component\Security\Core\Authentication\Token\Storage\TokenStorageInterface'
            - '@Symfony\Component\Security\Core\Authorization\AuthorizationCheckerInterface'
            - '@Symfony\Component\EventDispatcher\EventDispatcherInterface'
            - '@Kunstmaan\AdminBundle\Helper\CloneHelper'

    Kunstmaan\NodeBundle\Helper\NodeAdmin\NodeVersionLockHelper:
        arguments:
            - '@Symfony\Component\DependencyInjection\ContainerInterface'
            - '@Doctrine\ORM\EntityManagerInterface'

    Kunstmaan\NodeBundle\Helper\Menu\ActionsMenuBuilder:
        arguments:
            - '@knp_menu.factory'
            - '@Doctrine\ORM\EntityManagerInterface'
            - '@Symfony\Component\Routing\RouterInterface'
            - '@Symfony\Component\EventDispatcher\EventDispatcherInterface'
            - '@Symfony\Component\Security\Core\Authorization\AuthorizationCheckerInterface'
            - '@Kunstmaan\NodeBundle\Helper\PagesConfiguration'

    kunstmaan_node.menu.sub_actions:
        class: Knp\Menu\MenuItem # the service definition requires setting the class
        factory: ['@kunstmaan_node.actions_menu_builder', createSubActionsMenu]
        tags:
            - { name: 'knp_menu.menu', alias: 'sub_actions' } # The alias is what is used to retrieve the menu

    kunstmaan_node.menu.actions:
        class: Knp\Menu\MenuItem # the service definition requires setting the class
        factory: ['@kunstmaan_node.actions_menu_builder', createActionsMenu]
        tags:
            - { name: 'knp_menu.menu', alias: 'actions' } # The alias is what is used to retrieve the menu

    kunstmaan_node.menu.top_actions:
        class: Knp\Menu\MenuItem # the service definition requires setting the class
        factory: ['@kunstmaan_node.actions_menu_builder', createTopActionsMenu]
        tags:
            - { name: 'knp_menu.menu', alias: 'top_actions' } # The alias is what is used to retrieve the menu

    Kunstmaan\NodeBundle\EventListener\FixDateListener:
        tags:
            - { name: kernel.event_listener, event: kernel.response, method: onKernelResponse, priority: -100 }

    Kunstmaan\NodeBundle\EventListener\NodeListener:
        class:
        arguments:
            - '@Symfony\Component\Security\Core\Authorization\AuthorizationCheckerInterface'
            - '@Kunstmaan\AdminBundle\Helper\Security\Acl\Permission\PermissionAdmin'
            - '@Kunstmaan\AdminBundle\Helper\Security\Acl\Permission\PermissionMap'
        tags:
            - { name: kernel.event_listener, event: kunstmaan_node.adaptForm, method: adaptForm }

    Kunstmaan\NodeBundle\EventListener\LogPageEventsSubscriber:
        arguments:
            - '@kunstmaan_admin.logger'
            - '@Symfony\Component\Security\Core\Authentication\Token\Storage\TokenStorageInterface'
        tags:
            - { name: kernel.event_subscriber }

    Kunstmaan\NodeBundle\Router\SlugRouter:
        arguments:
            - '@Symfony\Component\DependencyInjection\ContainerInterface'
        tags:
            - { name: router, priority: 0 }

    Kunstmaan\NodeBundle\Twig\PagesConfigurationTwigExtension:
        public: false
        arguments:
            - '@Kunstmaan\NodeBundle\Helper\PagesConfiguration'
        tags:
            - { name: twig.extension }

    Kunstmaan\NodeBundle\Twig\UrlReplaceTwigExtension:
        arguments:
            - '@Kunstmaan\NodeBundle\Helper\URLHelper'
        tags:
            - { name: twig.extension }

    Kunstmaan\NodeBundle\Helper\Services\PageCreatorService:
        calls:
            - [ setEntityManager, [ '@Doctrine\ORM\EntityManagerInterface' ] ]
            - [ setACLPermissionCreatorService, [ '@Kunstmaan\NodeBundle\Helper\Services\ACLPermissionCreatorService' ] ]
            - [ setUserEntityClass, [ '%fos_user.model.user.class%' ] ]

    Kunstmaan\NodeBundle\Helper\Services\ACLPermissionCreatorService:
        calls:
            - [ setAclProvider, [ '@Symfony\Component\Security\Acl\Model\AclProviderInterface' ] ]
            - [ setObjectIdentityRetrievalStrategy, [ '@security.acl.object_identity_retrieval_strategy' ] ]

    Kunstmaan\NodeBundle\EventListener\MappingListener:
        arguments:
            - '%fos_user.model.user.class%'
        tags:
            - { name: doctrine.event_listener, event: loadClassMetadata }

    Kunstmaan\NodeBundle\EventListener\SlugListener:
        arguments:
            - '@Doctrine\ORM\EntityManagerInterface'
            - '@controller_resolver'
            - '@Symfony\Component\EventDispatcher\EventDispatcherInterface'
        tags:
            - { name: kernel.event_listener, event: kernel.controller, method: onKernelController }

    Kunstmaan\NodeBundle\EventListener\SlugSecurityListener:
        arguments:
            - '@Doctrine\ORM\EntityManagerInterface'
            - '@Symfony\Component\Security\Core\Authorization\AuthorizationCheckerInterface'
            - '@Kunstmaan\NodeBundle\Helper\NodeMenu'
        tags:
            - { name: kernel.event_listener, event: kunstmaan_node.slug.security, method: onSlugSecurityEvent }

    Kunstmaan\NodeBundle\EventListener\RenderContextListener:
        arguments:
            - '@Symfony\Bundle\FrameworkBundle\Templating\EngineInterface'
            - '@Doctrine\ORM\EntityManagerInterface'
        tags:
            - { name: kernel.event_listener, event: kernel.view, method: onKernelView }

    Kunstmaan\NodeBundle\Helper\NodeMenu:
        arguments:
            - '@Doctrine\ORM\EntityManagerInterface'
            - '@Symfony\Component\Security\Core\Authentication\Token\Storage\TokenStorageInterface'
            - '@Kunstmaan\AdminBundle\Helper\Security\Acl\AclHelper'
            - '@Kunstmaan\AdminBundle\Helper\DomainConfigurationInterface'

    Kunstmaan\NodeBundle\Twig\NodeTwigExtension:
        arguments:
            - '@Doctrine\ORM\EntityManagerInterface'
            - '@Symfony\Component\Routing\RouterInterface'
            - '@Kunstmaan\NodeBundle\Helper\NodeMenu'
            - '@Symfony\Component\HttpFoundation\RequestStack'
        tags:
            - { name: twig.extension }

    Kunstmaan\NodeBundle\Helper\URLHelper:
        arguments:
            - '@Doctrine\ORM\EntityManagerInterface'
            - '@Symfony\Component\Routing\RouterInterface'
            - '@Psr\Log\LoggerInterface'
            - '@Kunstmaan\AdminBundle\Helper\DomainConfigurationInterface'

    Kunstmaan\NodeBundle\Controller\UrlReplaceController:
        arguments:
            - '@Kunstmaan\NodeBundle\Helper\URLHelper'

    Kunstmaan\NodeBundle\Helper\PagesConfiguration: ~

    ### TOOLBAR DATA COLLECTOR ###
    Kunstmaan\NodeBundle\Toolbar\NodeDataCollector:
        parent: Kunstmaan\AdminBundle\Helper\Toolbar\AbstractDataCollector
        arguments:
            - '@Kunstmaan\NodeBundle\Helper\NodeMenu'
            - '@Symfony\Component\Routing\RouterInterface'
        tags:
            - { name: kunstmaan_admin.toolbar_collector, template: 'KunstmaanNodeBundle:Toolbar:node.html.twig', id: kuma_node}
