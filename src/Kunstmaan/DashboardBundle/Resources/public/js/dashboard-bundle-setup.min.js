$(function(){function e(){$("#accounts select").trigger("chosen:updated"),$("#properties select").trigger("chosen:updated"),$("#profiles select").trigger("chosen:updated"),$("#accounts select").trigger("liszt:updated"),$("#properties select").trigger("liszt:updated"),$("#profiles select").trigger("liszt:updated")}function t(t){var a=$("#path_properties").attr("data-url");$("#properties select").children().each(function(e){0!=e&&$(this).remove()}),$("#profiles select").children().each(function(e){0!=e&&$(this).remove()}),$.ajax({type:"get",url:a,data:{accountId:t},success:function(t){$.each(t,function(a,s){var i=$("<option>",{"data-id":t[a].propertyId,text:t[a].propertyName});$("#properties select").append(i),$("#properties").fadeIn(),$("#accounts select").removeAttr("disabled"),e()})},error:function(t){$("#accounts select").removeAttr("disabled"),e()}})}function a(t){var a=$("#path_profiles").attr("data-url");$("#profiles select").children().each(function(e){0!=e&&$(this).remove()}),$.ajax({type:"get",url:a,data:{propertyId:t,accountId:i},success:function(t){$.each(t,function(a,s){var i=$("<option>",{"data-id":t[a].profileId,text:t[a].profileName});$("#profiles select").append(i),$("#profiles").fadeIn(),$("#properties select").removeAttr("disabled"),$("#accounts select").removeAttr("disabled"),e()})},error:function(t){$("#properties select").removeAttr("disabled"),$("#accounts select").removeAttr("disabled"),e()}})}function s(e,t){e||(e=""),t||(t="");var a=$.now(),s=$("<div>",{id:"segmentDiv"+a,class:"well add-segment__wrapper clearfix"}),i=$("<input>",{type:"text",id:"segment"+a,class:"segment-query",placeholder:"query",value:t}),n=$("<input>",{type:"text",id:"segment_name"+a,class:"segment-name",placeholder:"name",value:e}),r=$("<input>",{type:"button","data-segment-id":"segmentDiv"+a,class:"btn btn-danger pull-right",value:"cancel"});r.click(function(){var e=$(this).attr("data-segment-id");return $("#"+e).remove(),!1}),s.append(n),s.append(i),s.append(r),$("#segments-new").append(s)}var i=$("#account_id").attr("data-id"),n=$("#property_id").attr("data-id"),r=$("#profile_id").attr("data-id"),d=$("#config_id").attr("data-id");$("#submit_save").click(function(){var e=0;$("#disableGoals").is(":checked")&&(e=1);var t=$("#path_config_save").attr("data-url");return $.ajax({type:"get",url:t,data:{profileId:r,propertyId:n,accountId:i,disableGoals:e,configId:d},success:function(e){var t=$("#segments-new").children();t.length||location.reload();for(var a=0;a<t.length;a++){var s=$(t[a]).find("input.segment-query").val(),i=$(t[a]).find("input.segment-name").val();if(i&&""!=i&&s&&""!=s){var n=$("#path_segment_add").attr("data-url");$.ajax({type:"get",url:n,data:{query:s,name:i,configId:d},success:function(e){location.reload()}})}}}}),!1}),$("#disableGoals").change(function(){$("#submit_save").removeAttr("disabled")}),$("#accounts select").change(function(){$("#accounts select").attr("disabled","disabled"),e(),$("#properties").fadeOut(),$("#profiles").fadeOut(),$("#accounts select option:selected").each(function(){i=$(this).attr("data-id"),t(i)})}),$("#properties select").change(function(){$("#profiles").fadeOut(),$("#properties select").attr("disabled","disabled"),$("#accounts select").attr("disabled","disabled"),e(),$("#profiles select").addClass("setup-item__not_shown"),$("#properties select option:selected").each(function(){n=$(this).attr("data-id"),a(n)})}),$("#profiles select").change(function(){$("#submit_save").removeAttr("disabled"),$("#profiles select option:selected").each(function(){r=$(this).attr("data-id"),$("#submit_save").removeAttr("disabled")})}),$("#segment-button__add").click(function(){return $("#submit_save").removeAttr("disabled"),s(),!1}),$(".segment-list-button__delete").click(function(){var e=$(this).attr("data-segment-id"),t=$("#path_segment_delete").attr("data-url");return $.ajax({type:"get",url:t,data:{id:e},success:function(t){$("#segment-list__"+e).fadeOut()}}),!1}),$(".segment-list-button__edit").click(function(){var e=$(this).attr("data-segment-id");return $("#segment-list__"+e+" .edit-view").css("display","block"),$("#segment-list__"+e+" .display-view").css("display","none"),!1}),$(".segment-list-button__confirm").click(function(){var e=$(this).attr("data-segment-id"),t=$("#segment-list__"+e).find("input.segment-query").val(),a=$("#segment-list__"+e).find("input.segment-name").val();if(t&&a){var s=$("#path_segment_edit").attr("data-url");$.ajax({type:"get",url:s,data:{id:e,name:a,query:t},success:function(s){$("#segment-list__"+e+" .edit-view").css("display","none"),$("#segment-list__"+e+" .display-view").css("display","block"),$("#segment-list__"+e+" .display-segment-query").html(t),$("#segment-list__"+e+" .display-segment-name").html(a)}})}else $("#segment-list__"+e+" .edit-view").css("display","none"),$("#segment-list__"+e+" .display-view").css("display","block");return!1})});