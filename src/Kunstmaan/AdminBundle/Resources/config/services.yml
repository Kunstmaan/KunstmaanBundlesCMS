parameters:
    kunstmaan_admin.menubuilder.class: 'Kunstmaan\AdminBundle\Helper\Menu\MenuBuilder'
    kunstmaan_admin.admin_panel.class: 'Kunstmaan\AdminBundle\Helper\AdminPanel\AdminPanel'
    kunstmaan_admin.login.listener.class: 'Kunstmaan\AdminBundle\EventListener\LoginListener'
    kunstmaan_admin.admin_locale.listener.class: 'Kunstmaan\AdminBundle\EventListener\AdminLocaleListener'
    kunstmaan_admin.acl.helper.class: 'Kunstmaan\AdminBundle\Helper\Security\Acl\AclHelper'
    kunstmaan_admin.acl.native.helper.class: 'Kunstmaan\AdminBundle\Helper\Security\Acl\AclNativeHelper'
    kunstmaan_admin.security.acl.permission.map.class: 'Kunstmaan\AdminBundle\Helper\Security\Acl\Permission\PermissionMap'
    kunstmaan_admin.clone.listener.class: 'Kunstmaan\AdminBundle\EventListener\CloneListener'
    kunstmaan_admin.session_security.class: 'Kunstmaan\AdminBundle\EventListener\SessionSecurityListener'
    kunstmaan_admin.password_resetting.listener.class: 'Kunstmaan\AdminBundle\EventListener\PasswordResettingListener'
    kunstmaan_admin.password_check.listener.class: 'Kunstmaan\AdminBundle\EventListener\PasswordCheckListener'
    kunstmaan_admin.firewall.provider_key: 'main'
    kunstmaan_admin.domain_configuration.class: 'Kunstmaan\AdminBundle\Helper\DomainConfiguration'
    kunstmaan_admin.validator.password_restrictions.class: 'Kunstmaan\AdminBundle\Validator\Constraints\PasswordRestrictionsValidator'
    kunstmaan_admin.adminroute.helper.class: 'Kunstmaan\AdminBundle\Helper\AdminRouteHelper'
    kunstmaan_admin.adminroute.twig.class: 'Kunstmaan\AdminBundle\Twig\AdminRouteHelperTwigExtension'
    kunstmaan_admin.exception.listener.class: 'Kunstmaan\AdminBundle\EventListener\ExceptionSubscriber'
    kunstmaan_admin.toolbar.listener.class: 'Kunstmaan\AdminBundle\EventListener\ToolbarListener'
    kunstmaan_admin.toolbar.collector.bundle.class: 'Kunstmaan\AdminBundle\Toolbar\BundleVersionDataCollector'
    kunstmaan_admin.toolbar.collector.exception.class: 'Kunstmaan\AdminBundle\Toolbar\ExceptionDataCollector'

services:
    Kunstmaan\AdminBundle\Helper\Menu\MenuBuilder:
        arguments:
            - '@Symfony\Component\DependencyInjection\ContainerInterface'

    Kunstmaan\AdminBundle\Helper\AdminPanel\AdminPanel: ~

    Kunstmaan\AdminBundle\Helper\Menu\ModulesMenuAdaptor:
        tags:
            -  { name: 'kunstmaan_admin.menu.adaptor' }

    Kunstmaan\AdminBundle\Helper\Menu\SettingsMenuAdaptor:
        arguments:
            - '@Symfony\Component\Security\Core\Authorization\AuthorizationCheckerInterface'
            - "%version_checker.enabled%"
        tags:
            -  { name: 'kunstmaan_admin.menu.adaptor' }

    Kunstmaan\AdminBundle\EventListener\LoginListener:
        arguments:
            - '@kunstmaan_admin.logger'
            - '@Kunstmaan\AdminBundle\Helper\VersionCheck\VersionChecker'
            - '@Kunstmaan\AdminBundle\Helper\AdminRouteHelper'
        tags:
            - { name: 'kernel.event_listener', event: 'security.interactive_login' }

    Kunstmaan\AdminBundle\EventListener\AdminLocaleListener:
        arguments:
            - '@Symfony\Component\Security\Core\Authentication\Token\Storage\TokenStorageInterface'
            - '@Symfony\Component\Translation\TranslatorInterface'
            - '@Kunstmaan\AdminBundle\Helper\AdminRouteHelper'
            - '%kunstmaan_admin.default_admin_locale%'
            - '%kunstmaan_admin.firewall.provider_key%'
        tags:
            - { name: 'kernel.event_listener', event: 'kernel.request', method: 'onKernelRequest' }

    Kunstmaan\AdminBundle\Twig\MenuTwigExtension:
        arguments:
            - '@Kunstmaan\AdminBundle\Helper\Menu\MenuBuilder'
            - '@Kunstmaan\AdminBundle\Helper\AdminPanel\AdminPanel'
        tags:
            -  { name: 'twig.extension' }

    Kunstmaan\AdminBundle\Twig\LocaleSwitcherTwigExtension:
        arguments: ['@kunstmaan_admin.domain_configuration']
        tags:
            -  { name: 'twig.extension' }

    Kunstmaan\AdminBundle\Twig\MultiDomainAdminTwigExtension:
        arguments:
            - '@Kunstmaan\AdminBundle\Helper\DomainConfigurationInterface'
        tags:
              -  { name: 'twig.extension' }

    Kunstmaan\AdminBundle\Twig\DateByLocaleExtension:
        tags:
            - { name: 'twig.extension' }

    Kunstmaan\AdminBundle\Twig\FormToolsExtension:
        arguments: ['@kunstmaan_admin.form.helper']
        tags:
            - { name: 'twig.extension' }

    Kunstmaan\AdminBundle\Twig\AdminPermissionsTwigExtension:
        tags:
            -  { name: 'twig.extension' }

    Kunstmaan\AdminBundle\Helper\Security\Acl\AclHelper:
        arguments:
            - '@Doctrine\ORM\EntityManagerInterface'
            - '@Symfony\Component\Security\Core\Authentication\Token\Storage\TokenStorageInterface'
            - '@security.role_hierarchy'

    Kunstmaan\AdminBundle\Helper\Security\Acl\AclNativeHelper:
        arguments:
            - '@Doctrine\ORM\EntityManagerInterface'
            - '@Symfony\Component\Security\Core\Authentication\Token\Storage\TokenStorageInterface'
            - '@security.role_hierarchy'

    Kunstmaan\AdminBundle\Helper\Security\Acl\Permission\PermissionMap: ~

    Kunstmaan\AdminBundle\Helper\Security\Acl\Voter\AclVoter:
        arguments:
            - '@Symfony\Component\Security\Acl\Model\AclProviderInterface'
            - '@security.acl.object_identity_retrieval_strategy'
            - '@security.acl.security_identity_retrieval_strategy'
            - '@kunstmaan_admin.security.acl.permission.map'
        tags:
            - { name: security.voter, priority: 255 }
            - { name: monolog.logger, channel: security }
        # small performance boost
        public: false

    Kunstmaan\AdminBundle\Helper\Security\Acl\Permission\PermissionAdmin:
        arguments:
            - '@Doctrine\ORM\EntityManagerInterface'
            - '@Symfony\Component\Security\Core\Authentication\Token\Storage\TokenStorageInterface'
            - '@Symfony\Component\Security\Acl\Model\AclProviderInterface'
            - '@security.acl.object_identity_retrieval_strategy'
            - '@Symfony\Component\EventDispatcher\EventDispatcherInterface'
            - '@kunstmaan_utilities.shell'
            - '@kernel'

    Kunstmaan\AdminBundle\Helper\CloneHelper:
        arguments:
            - '@Doctrine\ORM\EntityManagerInterface'
            - '@Symfony\Component\EventDispatcher\EventDispatcherInterface'

    Kunstmaan\AdminBundle\Helper\AdminRouteHelper:
        arguments:
            - '%kunstmaan_admin.admin_prefix%'
            - '@Symfony\Component\HttpFoundation\RequestStack'

    Kunstmaan\AdminBundle\Twig\AdminRouteHelperTwigExtension:
        arguments:
            - '@Kunstmaan\AdminBundle\Helper\AdminRouteHelper'
        tags:
            -  { name: 'twig.extension' }

    Kunstmaan\AdminBundle\EventListener\CloneListener:
        tags:
            - { name: kernel.event_listener, event: kunstmaan_admin.onDeepCloneAndSave, method: onDeepCloneAndSave }

    Kunstmaan\AdminBundle\Helper\UserProcessor:
        arguments:
            - '@Symfony\Component\DependencyInjection\ContainerInterface'
        tags:
            - { name: monolog.processor, method: processRecord }
            - { name: kunstmaan_admin.logger.processor, method: processRecord }

    kunstmaan_admin.logger.handler:
        class: Monolog\Handler\RotatingFileHandler
        arguments:
            - '%kernel.logs_dir%/kunstmaan_%kernel.environment%.log'
            - 10

    kunstmaan_admin.logger:
        class: Symfony\Bridge\Monolog\Logger
        arguments: [kunstmaan]
        calls:
            - [pushHandler, ['@kunstmaan_admin.logger.handler']]

    Kunstmaan\AdminBundle\Helper\FormHelper: ~

    Kunstmaan\AdminBundle\Twig\TabsTwigExtension:
        tags:
            - { name: twig.extension }

    Kunstmaan\AdminBundle\Helper\Creators\ACLPermissionCreator:
        arguments:
            - '@security.acl.provider'
            - '@security.acl.object_identity_retrieval_strategy'

    Kunstmaan\AdminBundle\Helper\VersionCheck\VersionChecker:
        arguments:
            - '@Symfony\Component\DependencyInjection\ContainerInterface'
            - '@kunstmaan_admin.cache'

    kunstmaan_admin.cache:
        class: Doctrine\Common\Cache\FilesystemCache
        arguments:
            - '%kernel.cache_dir%/fcache'

    Kunstmaan\AdminBundle\Form\ColorType:
        tags:
            - { name: form.type }

    Kunstmaan\AdminBundle\EventListener\MappingListener:
        arguments:
            - '%fos_user.model.user.class%'
        tags:
            - { name: doctrine.event_listener, event: loadClassMetadata }

    Kunstmaan\AdminBundle\Form\RangeType:
        tags:
            - { name: form.type }

    Kunstmaan\AdminBundle\EventListener\SessionSecurityListener:
        arguments:
            - '%kunstmaan_admin.session_security.ip_check%'
            - '%kunstmaan_admin.session_security.user_agent_check%'
            - '@Psr\Log\LoggerInterface'
        tags:
            - { name: kernel.event_listener, event: kernel.request, method: onKernelRequest }
            - { name: kernel.event_listener, event: kernel.response, method: onKernelResponse, priority: -1000 }

    Kunstmaan\AdminBundle\Form\WysiwygType:
        tags:
            - { name: form.type }

    Kunstmaan\AdminBundle\EventListener\PasswordResettingListener:
        arguments:
            - '@FOS\UserBundle\Model\UserManagerInterface'
        tags:
            - { name: kernel.event_listener, event: fos_user.change_password.edit.completed, method: onPasswordResettingSuccess }

    Kunstmaan\AdminBundle\EventListener\PasswordCheckListener:
        arguments:
            - '@Symfony\Component\Security\Core\Authorization\AuthorizationCheckerInterface'
            - '@Symfony\Component\Security\Core\Authentication\Token\Storage\TokenStorageInterface'
            - '@Symfony\Component\Routing\RouterInterface'
            - '@Symfony\Component\HttpFoundation\Session\SessionInterface'
            - '@Symfony\Component\Translation\TranslatorInterface'
            - '@Kunstmaan\AdminBundle\Helper\AdminRouteHelper'
        tags:
            - { name: kernel.event_listener, event: kernel.request, method: onKernelRequest, priority: 1 }

    Kunstmaan\AdminBundle\Helper\AdminPanel\DefaultAdminPanelAdaptor:
        arguments:
            - '@Symfony\Component\Security\Core\Authentication\Token\Storage\TokenStorageInterface'
        tags:
            -  { name: 'kunstmaan_admin.admin_panel.adaptor' }

    Kunstmaan\AdminBundle\Helper\DomainConfiguration:
        arguments: ['@service_container']

    Kunstmaan\AdminBundle\Security\OAuthAuthenticator:
        arguments:
            - '@Symfony\Component\Routing\RouterInterface'
            - '@Symfony\Component\HttpFoundation\Session\SessionInterface'
            - '@Symfony\Component\Translation\TranslatorInterface'
            - '@kunstmaan_admin.oauth_user_creator'
            - '%kunstmaan_admin.google_signin.client_id%'
            - '%kunstmaan_admin.google_signin.client_secret%'

    Kunstmaan\AdminBundle\Helper\Security\OAuth\OAuthUserCreator:
        arguments:
            - '@Doctrine\ORM\EntityManagerInterface'
            - '%kunstmaan_admin.google_signin.hosted_domains%'
            - '%fos_user.model.user.class%'
            - '@kunstmaan_admin.oauth_user_finder'

    Kunstmaan\AdminBundle\Helper\Security\OAuth\OAuthUserFinder:
        arguments:
            - '@Doctrine\ORM\EntityManagerInterface'
            - '%fos_user.model.user.class%'

    Kunstmaan\AdminBundle\Twig\GoogleSignInTwigExtension:
        arguments:
            - '%kunstmaan_admin.google_signin.enabled%'
            - '%kunstmaan_admin.google_signin.client_id%'
        tags:
            - { name: twig.extension }

    Kunstmaan\AdminBundle\Twig\SidebarTwigExtension:
        tags:
            - { name: twig.extension }

    Kunstmaan\AdminBundle\Validator\Constraints\PasswordRestrictionsValidator:
        arguments:
            - '%kunstmaan_admin.password_restrictions.min_digits%'
            - '%kunstmaan_admin.password_restrictions.min_uppercase%'
            - '%kunstmaan_admin.password_restrictions.min_special_characters%'
            - '%kunstmaan_admin.password_restrictions.min_length%'
            - '%kunstmaan_admin.password_restrictions.max_length%'
        tags:
            - { name: validator.constraint_validator, alias: password_restrictions }

    Kunstmaan\AdminBundle\EventListener\ExceptionSubscriber:
        arguments:
            - '@Doctrine\ORM\EntityManagerInterface'
            - "%kunstmaan_admin.admin_exception_excludes%"
        tags:
            - { name: kernel.event_subscriber }

    ### TOOLBAR DATA COLLECTOR ###

    Kunstmaan\AdminBundle\Twig\ToolbarTwigExtension:
        tags:
            - { name: twig.extension }

    Kunstmaan\AdminBundle\Helper\Toolbar\DataCollector:
        arguments:
             - '@router'

    Kunstmaan\AdminBundle\Helper\Toolbar\AbstractDataCollector:
        abstract: true
        calls:
            - [setAdminRouteHelper, ['@kunstmaan_admin.adminroute.helper']]

    Kunstmaan\AdminBundle\EventListener\ToolbarListener:
        tags:
            - { name: kernel.event_subscriber }
        arguments:
            - '@Twig_Environment'
            - '@Symfony\Component\Routing\Generator\UrlGeneratorInterface'
            - '@Kunstmaan\AdminBundle\Helper\Toolbar\DataCollector'
            - '@Symfony\Component\Security\Core\Authorization\AuthorizationCheckerInterface'
            - '@Symfony\Component\Security\Core\Authentication\Token\Storage\TokenStorageInterface'
            - '%kunstmaan_admin.enable_toolbar_helper%'
            - '@Symfony\Component\DependencyInjection\ContainerInterface'
            - '@Kunstmaan\AdminBundle\Helper\AdminRouteHelper'
            - '%kunstmaan_admin.provider_keys%'

    Kunstmaan\AdminBundle\Toolbar\BundleVersionDataCollector:
        arguments:
            - '@Kunstmaan\AdminBundle\Helper\VersionCheck\VersionChecker'
            - '@kunstmaan_admin.cache'
        tags:
            - { name: kunstmaan_admin.toolbar_collector, template: 'KunstmaanAdminBundle:Toolbar:bundles_version.html.twig', id: kuma_bundle_versions }

    Kunstmaan\AdminBundle\Toolbar\ExceptionDataCollector:
        arguments:
            - '@Doctrine\ORM\EntityManagerInterface'
        tags:
            - { name: kunstmaan_admin.toolbar_collector, template: 'KunstmaanAdminBundle:Toolbar:exception.html.twig', id: kuma_exception }
